# Actions Overview

출처: https://docs.svar.dev/react/gantt/api/overview/actions_overview

## 개요

Gantt `API`에서 사용 가능한 모든 `actions`입니다. `actions`은 Gantt 차트에서 발생하는 이벤트이며, `api.on()` 메서드로 리스닝하거나 `api.exec()` 메서드로 프로그래밍 방식으로 트리거할 수 있습니다.

---

## Task 관련 액션

### `add-task`

**설명:** 새로운 작업을 추가할 때 발생합니다.

**발생 시점:** 사용자가 작업을 추가하거나 `api.exec("add-task", ...)`가 실행될 때

**페이로드:**
```javascript
{
  id: string | number,     // 새로 추가된 작업의 ID
  task: Object,            // 추가된 작업 객체
  mode: string,            // "after" | "before" | "child"
  target?: string | number // 기준이 되는 작업 ID
}
```

**사용 예:**
```javascript
// 이벤트 리스닝
api.on("add-task", (ev) => {
  console.log("새 작업 추가됨:", ev.id);
});

// 액션 실행
api.exec("add-task", {
  task: {
    text: "새로운 작업",
    start: new Date(),
    duration: 1,
    type: "task"
  },
  target: 1,
  mode: "after"
});
```

---

### `update-task`

**설명:** 작업이 업데이트될 때 발생합니다.

**발생 시점:** 사용자가 작업 정보를 변경하거나 `api.exec("update-task", ...)`가 실행될 때

**페이로드:**
```javascript
{
  id: string | number,     // 업데이트된 작업의 ID
  task: Object             // 변경된 작업 객체
}
```

**사용 예:**
```javascript
// 이벤트 리스닝
api.on("update-task", (ev) => {
  console.log("작업 업데이트됨:", ev.id);
});

// 액션 실행
api.exec("update-task", {
  id: 1,
  task: {
    text: "수정된 작업명",
    progress: 50
  }
});
```

---

### `delete-task`

**설명:** 작업이 삭제될 때 발생합니다.

**발생 시점:** 사용자가 작업을 삭제하거나 `api.exec("delete-task", ...)`가 실행될 때

**페이로드:**
```javascript
{
  id: string | number,      // 삭제된 작업의 ID
  source: string | number   // 상위 작업의 ID
}
```

**사용 예:**
```javascript
// 이벤트 리스닝
api.on("delete-task", (ev) => {
  console.log("작업 삭제됨:", ev.id);
});

// 액션 실행
api.exec("delete-task", {
  id: 1
});
```

---

### `select-task`

**설명:** 작업이 선택될 때 발생합니다.

**발생 시점:** 사용자가 작업을 클릭하여 선택할 때

**페이로드:**
```javascript
{
  id: string | number      // 선택된 작업의 ID
}
```

**사용 예:**
```javascript
api.on("select-task", (ev) => {
  const task = api.getTask(ev.id);
  console.log("선택된 작업:", task.text);
});
```

---

### `move-task`

**설명:** 작업이 이동될 때 발생합니다.

**발생 시점:** 작업을 위 또는 아래로 이동할 때

**페이로드:**
```javascript
{
  id: string | number,      // 이동된 작업의 ID
  source: string | number,  // 원래 위치
  mode: "up" | "down",      // 이동 방향
  inProgress: boolean       // 이동 진행 중 여부
}
```

**사용 예:**
```javascript
// 이벤트 리스닝
api.on("move-task", (ev) => {
  console.log(`작업 ${ev.id}이(가) ${ev.mode} 방향으로 이동됨`);
});

// 액션 실행
api.exec("move-task", {
  id: 1,
  mode: "up"
});
```

---

### `copy-task`

**설명:** 작업이 복사될 때 발생합니다.

**발생 시점:** 사용자가 작업을 복사할 때

**페이로드:**
```javascript
{
  id: string | number,      // 새로 복사된 작업의 ID
  source: string | number   // 원본 작업의 ID
}
```

**사용 예:**
```javascript
api.on("copy-task", (ev) => {
  console.log("작업 복사됨:", ev.id);
});
```

---

### `open-task`

**설명:** 작업 브랜치가 확장될 때 발생합니다.

**발생 시점:** 사용자가 `summary` 또는 `parent` 작업을 클릭하여 `child tasks`를 표시할 때

**페이로드:**
```javascript
{
  id: string | number      // 확장된 작업의 ID
}
```

**사용 예:**
```javascript
api.on("open-task", (ev) => {
  console.log("작업 브랜치 확장됨:", ev.id);
});
```

---

## 드래그 및 인덴트 액션

### `drag-task`

**설명:** 작업이 드래그될 때 발생합니다.

**발생 시점:** 사용자가 작업을 드래그하고 있을 때

**페이로드:**
```javascript
{
  id: string | number,      // 드래그되는 작업의 ID
  top?: number,             // Y 좌표 (드래그 위치)
  parent?: string | number  // 새로운 부모 작업 ID
}
```

**주의사항:**
- `top`이 `undefined`이면 시간 축에서의 드래그입니다
- `top`이 정의되면 행 순서 변경 드래그입니다

**사용 예:**
```javascript
// 드래그 불가능하게 설정
api.intercept("drag-task", ({ id, top }) => {
  const task = api.getTask(id);
  if (task.type === "summary" && typeof top === "undefined") {
    return false;  // summary task 드래그 금지
  }
  return true;
});
```

---

### `indent-task`

**설명:** 작업이 인덴트될 때 발생합니다.

**발생 시점:** 사용자가 작업을 들여쓰기(indent)할 때

**페이로드:**
```javascript
{
  id: string | number,      // 인덴트된 작업의 ID
  mode: "indent" | "dedent" // 인덴트 방향
}
```

---

## 링크 관련 액션

### `add-link`

**설명:** 새로운 링크를 추가할 때 발생합니다.

**발생 시점:** 사용자가 두 작업 간의 링크를 생성할 때

**페이로드:**
```javascript
{
  id: string | number,      // 새 링크의 ID
  source: string | number,  // 출발 작업의 ID
  target: string | number,  // 도착 작업의 ID
  type: string              // 링크 타입
}
```

---

### `update-link`

**설명:** 링크가 업데이트될 때 발생합니다.

**발생 시점:** 링크 정보가 변경될 때

**페이로드:**
```javascript
{
  id: string | number,      // 업데이트된 링크의 ID
  link: Object              // 변경된 링크 객체
}
```

---

### `delete-link`

**설명:** 링크가 삭제될 때 발생합니다.

**발생 시점:** 사용자가 링크를 삭제할 때

**페이로드:**
```javascript
{
  id: string | number       // 삭제된 링크의 ID
}
```

---

## 에디터 액션

### `show-editor`

**설명:** `Editor` 대화상자가 열릴 때 발생합니다.

**발생 시점:** 사용자가 작업을 더블클릭하여 에디터를 열 때

**페이로드:**
```javascript
{
  id: string | number       // 에디터를 열 작업의 ID
}
```

---

## 데이터 및 스크롤 액션

### `request-data`

**설명:** 작업 브랜치에 대한 데이터가 필요할 때 발생합니다.

**발생 시점:** 사용자가 `lazy` 속성이 `true`인 작업을 확장할 때

**페이로드:**
```javascript
{
  id: string | number       // 데이터를 요청하는 작업의 ID
}
```

**사용 예:**
```javascript
api.on("request-data", (ev) => {
  // 백엔드에서 해당 작업의 child tasks 요청
  fetch(`/api/tasks/${ev.id}/children`)
    .then(res => res.json())
    .then(data => {
      api.exec("provide-data", {
        id: ev.id,
        data: data
      });
    });
});
```

---

### `provide-data`

**설명:** 요청된 데이터를 제공할 때 사용합니다.

**발생 시점:** `request-data` 액션에 대응하여 실행

**페이로드:**
```javascript
{
  id: string | number,      // 데이터를 제공받을 작업의 ID
  data: {
    tasks: Array,
    links: Array
  }
}
```

---

### `render-data`

**설명:** 데이터가 렌더링될 때 발생합니다.

**발생 시점:** 사용자가 차트를 스크롤할 때 새로운 데이터가 렌더링됨

**페이로드:**
```javascript
{
  start: string | number,    // 렌더링된 첫 번째 행의 ID
  end: string | number       // 렌더링된 마지막 행의 ID
}
```

---

### `scroll-chart`

**설명:** 차트가 스크롤될 때 발생합니다.

**발생 시점:** 사용자가 차트를 좌우로 스크롤할 때

**페이로드:**
```javascript
{
  // 스크롤 관련 정보
}
```

---

## 스케일 및 줌 액션

### `expand-scale`

**설명:** `scale`이 모든 여유 공간을 채우지 못할 때 발생합니다.

**발생 시점:** 차트의 시간 범위를 확장해야 할 때

**페이로드:**
```javascript
{
  // 확장 관련 정보
}
```

---

### `zoom-scale`

**설명:** 차트를 확대/축소할 때 발생합니다.

**발생 시점:** 사용자가 `Ctrl + 마우스 휠`로 줌을 조작할 때

**페이로드:**
```javascript
{
  level: number              // 현재 zoom 레벨
}
```

**사용 예:**
```javascript
api.on("zoom-scale", (ev) => {
  console.log("현재 zoom 레벨:", ev.level);
  const state = api.getState();
  console.log("현재 zoom 상태:", state.zoom);
});
```

---

## 정렬 액션

### `sort-tasks`

**설명:** 작업들이 정렬될 때 발생합니다.

**발생 시점:** 사용자가 컬럼 헤더를 클릭하여 정렬할 때

**페이로드:**
```javascript
{
  column: string,            // 정렬된 컬럼 ID
  order: "asc" | "desc"     // 정렬 순서
}
```

---

## 액션 처리 방법

### 1. 이벤트 리스닝 (`api.on()`)

```javascript
api.on("add-task", (ev) => {
  console.log("작업 추가됨:", ev.id);
});
```

### 2. 액션 실행 (`api.exec()`)

```javascript
api.exec("add-task", {
  task: { text: "새 작업", start: new Date(), duration: 1 }
});
```

### 3. 액션 가로채기 (`api.intercept()`)

```javascript
api.intercept("delete-task", (ev) => {
  return window.confirm("정말 삭제하시겠습니까?");
});
```

---

## 액션 흐름 예제

```javascript
const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      const api = apiRef.current;

      // 1. add-task 액션 리스닝
      api.on("add-task", (ev) => {
        console.log("작업 추가:", ev.id);
      });

      // 2. delete-task 액션 가로채기
      api.intercept("delete-task", (ev) => {
        const task = api.getTask(ev.id);
        return confirm(`"${task.text}"을 삭제하시겠습니까?`);
      });

      // 3. select-task 액션 리스닝
      api.on("select-task", (ev) => {
        const selectedTask = api.getTask(ev.id);
        console.log("선택된 작업:", selectedTask.text);
      });

      // 4. zoom-scale 액션 리스닝
      api.on("zoom-scale", (ev) => {
        console.log("줌 변경됨:", ev.level);
      });
    }
  }, [apiRef.current]);

  return <Gantt apiRef={apiRef} tasks={data.tasks} />;
};
```

