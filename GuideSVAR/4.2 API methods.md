# Methods Overview

출처: https://docs.svar.dev/react/gantt/api/overview/methods_overview

## 개요

Gantt `API`는 다음의 메서드들을 제공합니다. 이들 메서드를 사용하여 Gantt 차트를 프로그래밍 방식으로 제어할 수 있습니다.

---

## `api.exec(action, payload)`

### 설명

특정 `액션`을 실행하고 Gantt 상태를 변경합니다.

### 시그니처

```javascript
api.exec(action: string, payload?: any): void
```

### 주요 액션들

| 액션 | 설명 | 페이로드 예제 |
|------|------|------------|
| `add-task` | 새로운 작업 추가 | `{ task: {...}, target?: id, mode?: 'after' \| 'before' \| 'child' }` |
| `update-task` | 기존 작업 업데이트 | `{ id, task: {...} }` |
| `delete-task` | 작업 삭제 | `{ id }` |
| `move-task` | 작업 이동 | `{ id, mode: 'up' \| 'down' }` |
| `copy-task` | 작업 복사 | `{ id, target?: id, mode?: 'after' \| 'before' }` |
| `select-task` | 작업 선택 | `{ id }` |
| `drag-task` | 작업 드래그 | `{ id, top?: number, parent?: id }` |

### 예제

```javascript
import { useRef } from "react";
import { Gantt } from "wx-react-gantt";

const GanttComponent = () => {
  const apiRef = useRef();

  const handleAddTask = () => {
    if (apiRef.current) {
      apiRef.current.exec("add-task", {
        task: {
          text: "New Task",
          start: new Date(),
          duration: 1,
          type: "task"
        },
        mode: "after"
      });
    }
  };

  return (
    <>
      <button onClick={handleAddTask}>작업 추가</button>
      <Gantt apiRef={apiRef} tasks={[]} />
    </>
  );
};

export default GanttComponent;
```

---

## `api.on(action, handler)`

### 설명

특정 `액션`이 발생할 때 `handler` 함수를 실행합니다. 이벤트 리스너를 등록하는 방식입니다.

### 시그니처

```javascript
api.on(action: string, handler: (payload: any) => void): void
```

### 주요 액션들

| 액션 | 설명 | 페이로드 |
|------|------|--------|
| `add-task` | 작업 추가 시 발생 | `{ id, task }` |
| `update-task` | 작업 업데이트 시 발생 | `{ id, task }` |
| `delete-task` | 작업 삭제 시 발생 | `{ id, source }` |
| `select-task` | 작업 선택 시 발생 | `{ id }` |
| `move-task` | 작업 이동 시 발생 | `{ id, source, mode }` |
| `zoom-scale` | `zoom` 레벨 변경 시 발생 | `{ level }` |
| `open-task` | 작업 브랜치 확장 시 발생 | `{ id }` |
| `render-data` | 데이터 렌더링 시 발생 | `{ start, end }` |

### 예제

```javascript
import { useEffect, useRef } from "react";
import { getData } from "./data";
import { Gantt } from "wx-react-gantt";

const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      // 작업 추가 이벤트 리스닝
      apiRef.current.on("add-task", (ev) => {
        console.log("새로운 작업 추가됨:", ev.id);
      });

      // 작업 선택 이벤트 리스닝
      apiRef.current.on("select-task", (ev) => {
        console.log("선택된 작업:", ev.id);
      });

      // zoom 변경 이벤트 리스닝
      apiRef.current.on("zoom-scale", (ev) => {
        console.log("현재 zoom 레벨:", ev.level);
      });
    }
  }, [apiRef.current]);

  const data = getData();
  return <Gantt apiRef={apiRef} tasks={data.tasks} />;
};

export default GanttComponent;
```

---

## `api.getState()`

### 설명

현재 Gantt의 상태를 반환합니다.

### 시그니처

```javascript
api.getState(): {
  tasks: Array,
  links: Array,
  scales: Array,
  selected: Array,
  zoom: number,
  start: Date,
  end: Date,
  columns: Array,
  cellWidth: number,
  cellHeight: number,
  scaleHeight: number,
  lengthUnit: string,
  taskTypes: Array,
  activeTask: string | number,
  baselines: boolean
}
```

### 반환되는 상태 정보

| 속성 | 설명 |
|------|------|
| `tasks` | 현재 모든 작업들의 배열 |
| `links` | 현재 모든 링크들의 배열 |
| `scales` | 현재 설정된 `scales` |
| `selected` | 현재 선택된 작업들의 ID 배열 |
| `zoom` | 현재 `zoom` 레벨 |
| `start` | `timescale`의 시작 날짜 |
| `end` | `timescale`의 종료 날짜 |
| `columns` | 현재 컬럼 구성 |
| `cellWidth` | 현재 셀 너비 |
| `cellHeight` | 현재 셀 높이 |
| `scaleHeight` | 현재 스케일 높이 |
| `activeTask` | 현재 활성 작업 ID |

### 예제

```javascript
import { useEffect, useRef } from "react";
import { getData } from "./data";
import { Gantt } from "wx-react-gantt";

const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      const state = apiRef.current.getState();
      console.log("전체 작업 개수:", state.tasks.length);
      console.log("선택된 작업:", state.selected);
      console.log("현재 zoom:", state.zoom);
      console.log("시작 날짜:", state.start);
      console.log("종료 날짜:", state.end);
    }
  }, [apiRef.current]);

  const data = getData();
  return <Gantt apiRef={apiRef} tasks={data.tasks} />;
};

export default GanttComponent;
```

---

## `api.getReactiveState()`

### 설명

`reactive`한 현재 상태를 반환합니다. 상태가 변할 때마다 자동으로 업데이트됩니다.

### 시그니처

```javascript
api.getReactiveState(): {
  tasks: Array,
  selected: Array,
  // ... 기타 reactive 상태
}
```

### `getState()`와의 차이

- **`getState()`**: 호출 시점의 스냅샷을 반환하며, 일회성입니다
- **`getReactiveState()`**: 상태 변화에 반응하는 객체를 반환하며, 자동 업데이트됩니다

### 예제

```javascript
import { useEffect, useState, useRef } from "react";
import { getData } from "./data";
import { Gantt } from "wx-react-gantt";

const GanttComponent = () => {
  const apiRef = useRef();
  const [selected, setSelected] = useState([]);

  useEffect(() => {
    if (apiRef.current) {
      // reactiveState.selected가 변할 때마다 자동으로 업데이트됨
      const reactiveState = apiRef.current.getReactiveState();
      
      // 상태 변화를 추적
      const observer = () => {
        setSelected([...reactiveState.selected]);
      };
      
      // 이벤트를 통한 업데이트 감시
      apiRef.current.on("select-task", observer);
    }
  }, [apiRef.current]);

  const data = getData();
  
  return (
    <>
      <div>선택된 작업: {selected.join(", ") || "없음"}</div>
      <Gantt apiRef={apiRef} tasks={data.tasks} />
    </>
  );
};

export default GanttComponent;
```

---

## `api.getTask(id)`

### 설명

특정 ID를 가진 작업 객체를 반환합니다.

### 시그니처

```javascript
api.getTask(id: string | number): {
  id: string | number,
  text: string,
  start: Date,
  end: Date,
  duration: number,
  progress: number,
  type: string,
  parent: string | number,
  data: Array,  // child tasks
  // ... 기타 내부 속성
}
```

### 예제

```javascript
import { useEffect, useRef } from "react";
import { getData } from "./data";
import { Gantt } from "wx-react-gantt";

const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      // ID가 1인 작업 정보 조회
      const task = apiRef.current.getTask(1);
      if (task) {
        console.log("작업명:", task.text);
        console.log("시작 날짜:", task.start);
        console.log("진행도:", task.progress);
        console.log("하위 작업 개수:", task.data?.length || 0);
      }
    }
  }, [apiRef.current]);

  const data = getData();
  return <Gantt apiRef={apiRef} tasks={data.tasks} />;
};

export default GanttComponent;
```

---

## `api.intercept(action, handler)`

### 설명

특정 `액션`을 가로채서(intercept) 실행 여부를 제어합니다.

### 시그니처

```javascript
api.intercept(
  action: string, 
  handler: (payload: any) => boolean
): void
```

### 반환값

- **`true`**: 액션 실행 허용
- **`false`**: 액션 실행 거부

### 예제

```javascript
import { useEffect, useRef } from "react";
import { getData } from "./data";
import { Gantt } from "wx-react-gantt";

const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      // summary task를 드래그하는 것 방지
      apiRef.current.intercept("drag-task", ({ id, top }) => {
        const task = apiRef.current.getTask(id);
        // top이 undefined이면서 task 타입이 summary인 경우 드래그 금지
        if (typeof top === "undefined" && task.type === "summary") {
          console.log("Summary 작업은 드래그할 수 없습니다");
          return false;
        }
        return true;
      });

      // 작업 삭제 시 확인 대화상자
      apiRef.current.intercept("delete-task", ({ id }) => {
        const task = apiRef.current.getTask(id);
        const confirmDelete = window.confirm(
          `정말로 "${task.text}"를 삭제하시겠습니까?`
        );
        return confirmDelete;
      });
    }
  }, [apiRef.current]);

  const data = getData();
  return <Gantt apiRef={apiRef} tasks={data.tasks} />;
};

export default GanttComponent;
```

---

## `api.getStores()`

### 설명

Gantt의 내부 `stores` 객체를 반환합니다.

### 시그니처

```javascript
api.getStores(): {
  tasks: TaskStore,
  links: LinkStore,
  // ... 기타 stores
}
```

### 주의사항

일반적으로 직접 사용할 필요는 없으며, 고급 커스터마이징이 필요할 때만 사용합니다.

---

## `api.detach()`

### 설명

`API`에서 모든 이벤트 리스너를 제거합니다.

### 시그니처

```javascript
api.detach(): void
```

### 예제

```javascript
import { useEffect, useRef } from "react";
import { Gantt } from "wx-react-gantt";

const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      const handler = () => {
        console.log("작업이 추가되었습니다");
      };

      apiRef.current.on("add-task", handler);

      // 클린업: 컴포넌트 언마운트 시 리스너 제거
      return () => {
        if (apiRef.current) {
          apiRef.current.detach();
        }
      };
    }
  }, [apiRef.current]);

  return <Gantt apiRef={apiRef} tasks={[]} />;
};

export default GanttComponent;
```

---

## `api.setNext(state)`

### 설명

다음 상태를 설정합니다. `Event Bus`의 순서를 정의하는데 사용됩니다.

### 시그니처

```javascript
api.setNext(state: any): void
```

### 용도

`RestDataProvider` 같은 외부 `provider`를 `Event Bus`에 연결할 때 사용합니다.

### 예제

```javascript
import { RestDataProvider } from "wx-gantt-data-provider";
import { Gantt } from "wx-react-gantt";
import { useEffect, useRef } from "react";

const restProvider = new RestDataProvider("https://your-backend-url");

const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      // RestDataProvider를 Event Bus에 연결
      apiRef.current.setNext(restProvider);

      // 데이터 요청 액션 리스닝
      apiRef.current.on("request-data", (ev) => {
        restProvider.getData(ev.id).then(({ tasks, links }) => {
          apiRef.current.exec("provide-data", {
            id: ev.id,
            data: { tasks, links }
          });
        });
      });
    }
  }, [apiRef.current]);

  return <Gantt apiRef={apiRef} tasks={[]} />;
};

export default GanttComponent;
```

---

## 메서드 사용 흐름

### 전형적인 사용 패턴

```javascript
const GanttComponent = () => {
  const apiRef = useRef();

  useEffect(() => {
    if (apiRef.current) {
      const api = apiRef.current;

      // 1. 현재 상태 조회
      const state = api.getState();
      console.log(`현재 작업 수: ${state.tasks.length}`);

      // 2. 이벤트 리스닝
      api.on("add-task", (ev) => {
        console.log(`작업 추가됨: ${ev.id}`);
      });

      // 3. 액션 가로채기
      api.intercept("delete-task", (ev) => {
        const task = api.getTask(ev.id);
        return confirm(`${task.text}을 삭제하시겠습니까?`);
      });
    }
  }, [apiRef.current]);

  return <Gantt apiRef={apiRef} tasks={data.tasks} />;
};
```

